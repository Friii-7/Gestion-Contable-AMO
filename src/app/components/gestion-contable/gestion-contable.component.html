<div class="container-fluid py-4">
  <div class="row justify-content-center">
    <div class="col-12 col-lg-10 col-xl-8">

      <!-- Header -->
      <div class="text-center mb-4">
                 <h1 class="display-5 fw-bold text-primary">
           <mat-icon class="me-3">account_balance</mat-icon>
           Contabilidad Arte Medio Oriente
         </h1>
         <p class="lead text-muted">Sistema de control y registro de operaciones contables</p>



      </div>

      <!-- Formulario -->
      <mat-card class="shadow-lg border-0">
        <mat-card-header class="bg-primary text-white">
          <mat-card-title>
            <mat-icon class="me-2">receipt_long</mat-icon>
            Registro de Operación Contable
          </mat-card-title>
          <mat-card-subtitle class="text-white-50">
            Complete todos los campos para registrar la operación
          </mat-card-subtitle>
        </mat-card-header>

        <mat-card-content class="p-4">
          <form [formGroup]="form" (ngSubmit)="onSubmit()" autocomplete="off" class="row g-4">

            <!-- Fecha de Registro -->
            <div class="col-12 col-md-6">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Fecha de Registro</mat-label>
                <input matInput [matDatepicker]="picker" formControlName="fechaRegistro" placeholder="Seleccione fecha"
                  required>
                <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
                <mat-datepicker #picker></mat-datepicker>

                @if (hasError('fechaRegistro')) {
                <mat-error>{{ getErrorMessage('fechaRegistro') }}</mat-error>
                }
              </mat-form-field>
            </div>

            <!-- Valor de Ventas -->
            <div class="col-12 col-md-6">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Valor de Ventas</mat-label>
                <input matInput type="number" formControlName="valorVentas" placeholder="0" min="0" required>
                <mat-icon matSuffix class="text-success">attach_money</mat-icon>

                @if (hasError('valorVentas')) {
                <mat-error>{{ getErrorMessage('valorVentas') }}</mat-error>
                }
              </mat-form-field>
            </div>

            <!-- Observación de Venta -->
            <div class="col-12">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Observación de Venta</mat-label>
                <textarea matInput formControlName="observacionVenta" rows="3" placeholder="Describa qué vendió..."
                  required></textarea>
                <mat-icon matSuffix class="text-info">description</mat-icon>

                @if (hasError('observacionVenta')) {
                <mat-error>{{ getErrorMessage('observacionVenta') }}</mat-error>
                }
              </mat-form-field>
            </div>

            <!-- Método de Pago -->
            <div class="col-12 col-md-6">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Método de Pago</mat-label>
                <mat-select formControlName="metodoPago" required>
                  @for (metodo of METODOS_PAGO; track metodo.value) {
                    <mat-option [value]="metodo.value">
                      <div class="d-flex align-items-center">
                        <mat-icon class="me-2">{{ metodo.icon }}</mat-icon>
                        <span>{{ metodo.label }}</span>
                      </div>
                    </mat-option>
                  }
                </mat-select>
                <mat-icon matSuffix class="text-primary">payment</mat-icon>

                @if (hasError('metodoPago')) {
                <mat-error>{{ getErrorMessage('metodoPago') }}</mat-error>
                }
              </mat-form-field>
            </div>

            <!-- Valor del Pago -->
            <div class="col-12 col-md-6">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Valor del Pago</mat-label>
                <input matInput type="number" formControlName="valorPago" placeholder="0" min="0" required>
                <mat-icon matSuffix class="text-success">payments</mat-icon>

                @if (hasError('valorPago')) {
                <mat-error>{{ getErrorMessage('valorPago') }}</mat-error>
                }
              </mat-form-field>
              <small class="text-muted d-block mt-1">
                <mat-icon class="me-1" style="font-size: 16px; vertical-align: middle;">info</mat-icon>
                Si selecciona "Entrega a Reza", este valor se actualizará automáticamente con el valor de ventas.
              </small>
            </div>

            <!-- Gastos operativos (sin incluir pago Carlos) -->
            <div class="col-12 col-md-6">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Gastos operativos</mat-label>
                <input matInput type="number" formControlName="gastos" placeholder="0" min="0" required>
                <mat-icon matSuffix class="text-danger">money_off</mat-icon>

                @if (hasError('gastos')) {
                <mat-error>{{ getErrorMessage('gastos') }}</mat-error>
                }
              </mat-form-field>
            </div>

            <!-- Observación de Gasto -->
            <div class="col-12">
              <mat-form-field appearance="outline" class="w-100">
                <mat-label>Observación de Gasto</mat-label>
                <textarea matInput formControlName="observacionGasto" rows="3" placeholder="Describa en qué gastó..."
                  required></textarea>
                <mat-icon matSuffix class="text-warning">receipt</mat-icon>

                @if (hasError('observacionGasto')) {
                <mat-error>{{ getErrorMessage('observacionGasto') }}</mat-error>
                }
              </mat-form-field>
            </div>

            <!-- Pago del día a Carlos -->
            <div class="col-12">
              <mat-checkbox formControlName="pagoDiaCarlos" class="d-flex align-items-center">
                <mat-icon class="me-2 text-primary">person</mat-icon>
                <span class="ms-2">Pago del día a Carlos - {{ PAGO_DIARIO_CARLOS | currency:'COP':'symbol':'1.0-0'
                  }}</span>
              </mat-checkbox>
              <small class="text-muted d-block mt-1">
                Si marcas, se sumará automáticamente al total de gastos.
              </small>
            </div>

            <!-- Resumen -->
            <div class="col-12">
              <mat-divider class="my-3"></mat-divider>
              <div class="row text-center g-3">
                <div class="col-12 col-md-3">
                  <div class="card bg-light border-0">
                    <div class="card-body">
                      <h6 class="card-title text-muted">Ventas</h6>
                      <h4 class="text-success mb-0">
                        {{ form.get('valorVentas')?.value || 0 | currency:'COP':'symbol':'1.0-0' }}
                      </h4>
                    </div>
                  </div>
                </div>

                <div class="col-12 col-md-3">
                  <div class="card bg-light border-0">
                    <div class="card-body">
                      <h6 class="card-title text-muted">Valor Pago</h6>
                      <h4 class="text-primary mb-0">
                        {{ form.get('valorPago')?.value || 0 | currency:'COP':'symbol':'1.0-0' }}
                      </h4>
                      <small class="text-muted">{{ getMetodoPagoLabel() }}</small>
                    </div>
                  </div>
                </div>

                <div class="col-12 col-md-3">
                  <div class="card bg-light border-0">
                    <div class="card-body">
                      <h6 class="card-title text-muted">Gastos Operativos</h6>
                      <h4 class="text-warning mb-0">
                        {{ getGastosSinCarlos() | currency:'COP':'symbol':'1.0-0' }}
                      </h4>
                    </div>
                  </div>
                </div>

                <div class="col-12 col-md-3">
                  <div class="card bg-info text-white border-0">
                    <div class="card-body">
                      <h6 class="card-title">Pago Carlos</h6>
                      <h4 class="mb-0">
                        {{ (form.get('pagoDiaCarlos')?.value ? PAGO_DIARIO_CARLOS : 0) |
                        currency:'COP':'symbol':'1.0-0' }}
                      </h4>
                    </div>
                  </div>
                </div>

                <div class="col-12">
                  <div class="card bg-primary text-white border-0">
                    <div class="card-body">
                      <h6 class="card-title">Total</h6>
                      <h4 class="mb-0">{{ getTotal() | currency:'COP':'symbol':'1.0-0' }}</h4>
                      <small class="text-white-50">Ventas - Gastos Totales</small>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Mensaje de error general del formulario -->
            @if (form.errors?.['valorPagoInvalido']) {
            <div class="col-12">
              <div class="alert alert-danger d-flex align-items-center" role="alert">
                <mat-icon class="me-2">error</mat-icon>
                <div>
                  <strong>Error de validación:</strong> El valor del pago debe coincidir con el valor de ventas cuando se selecciona "Entrega a Reza".
                </div>
              </div>
            </div>
            }

            <!-- Acciones -->
            <div class="col-12 text-center mt-3">
              <div class="d-flex gap-3 justify-content-center flex-wrap">
                <button mat-raised-button color="primary" type="submit" >
                  @if (!isSubmitting()) { <mat-icon class="me-2">save</mat-icon> }
                  @if (isSubmitting()) { <mat-spinner diameter="20"></mat-spinner> }
                  {{ isSubmitting() ? 'Enviando...' : 'Guardar Registro' }}
                </button>

                <button mat-stroked-button type="button" (click)="limpiarFormulario()">
                  <mat-icon class="me-2">clear</mat-icon>
                  Limpiar Formulario
                </button>
              </div>
            </div>
          </form>
        </mat-card-content>
      </mat-card>

      <!-- Confirmación -->
      @if (formData()) {
      <div class="mt-4">
        <mat-card class="bg-success text-white border-0">
          <mat-card-content class="p-3">
            <div class="d-flex align-items-center">
              <mat-icon class="me-3">check_circle</mat-icon>
              <div>
                <h6 class="mb-1">¡Registro Exitoso!</h6>
                <p class="mb-0">Los datos han sido guardados correctamente.</p>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
      }
    </div>
  </div>
</div>

